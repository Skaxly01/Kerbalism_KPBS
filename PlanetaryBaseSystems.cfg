// ============================================================================
// = Patch Planetary Base Systems For Kerbalism Realism Profile               =
// ============================================================================

Note:
All values here were taken from the standard KPBS configuration for the
default kerbalism profile then converted to an equivalent realism profile
standard according to the VAB planner(rounding up). Other values are pure
guesswork.

// ============================================================================
// Patch PBS Greenhouse (Small and Large)
// ============================================================================
@PART[KKAOSS_LS_container_greenhouse]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@MODULE[Greenhouse]
	{
		@waste_name = Waste
		@ec_rate = 0.3 // Smaller greenhouse less EC needed
		@waste_rate = 0.00002 // requires less than waste
		@harvest_size = 120.0 // food consumed for 3 crew for 40 days at 1 food per day == 120 food
		@growth_rate = 0.0000005787 // 80 days to harvest
	}

	!RESOURCE[Crap]{}
	RESOURCE
	{
		name = Waste
		isTweakable = true
		isVisible = true
		amount = 0.0
		maxAmount = 7.5 // ??? Smaller Greenhouse less storage
	}
}

@PART[KKAOSS_Greenhouse_g]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@MODULE[Greenhouse]
	{
		@waste_name = Waste
		@waste_rate = 0.00004 // requires slightly less than waste/s for crew of 3
		@harvest_size = 270.0 // food consumed for 3 crew over 80 days at 1 food per day == 240 food
		@growth_rate = 0.0000005787 // 80 days to harvest -> Same grow time just more to harvest
	}

	!RESOURCE[Crap]{}
	RESOURCE
	{
		name = Waste
		isTweakable = true
		isVisible = true
		amount = 0.0
		maxAmount = 15.0 // ??? Large enough to store ~2 weeks of waste for a 3 man crew
	}
}


// ============================================================================
// Patch PBS Waste Container (Tweakable or not?)
// ============================================================================
@PART[KKAOSS_LS_container_waste_small]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	!RESOURCE[Crap]{}
	RESOURCE
	{
		name = Waste
		isTweakable = false
		isVisible = true
		amount = 0.0
		maxAmount = 48.5 // 45 ? days for 3 crew
	}
	RESOURCE
	{
		name = WasteWater
		isTweakable = false
		isVisible = true
		amount = 0.00
		maxAmount = 135.0 // ???
	}
}


// ============================================================================
// Patch PBS Air Filter
// ============================================================================
@PART[KKAOSS_LS_container_airfilter]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	!RESOURCE[CO2]{}
	RESOURCE
	{
		name = CarbonDioxide
		amount = 0.0
		maxAmount = 105.0
	}

		// Scrubber module here probably needs fixing...
		!MODULE[Scrubber]{}
		MODULE
		{
			name = Scrubber

			resource_name = Oxygen
			waste_name = CarbonDioxide
			ec_rate = 0.08
			co2_rate = 0.53 <--- Very wrong for a reason!!!
		}
}


// ============================================================================
// Patch The Various PBS Food Containers
// ============================================================================
@PART[KKAOSS_LS_container_food_small]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@RESOURCE[Food]
	{
		@amount = 84 // Default profile for 3 crew is 83d 1h in VAB planner rounded up
		@maxAmount = 84
	}
}

@PART[KKAOSS_LS_container_food_big]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@RESOURCE[Food]
	{
		@amount = 168 // Double it here
		@maxAmount = 168
	}
}

@PART[KKAOSS_LS_container_kerbalism_small]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@mass = 0.12
	@RESOURCE[Food]
	{
		@amount = 42 // Default profile for 3 crew is 41d 3h in VAB planner rounded up
		@maxAmount = 42
	}
	@RESOURCE[Oxygen]
	{
		@amount = 20250 // Default profile for 3 crew is 49d 5h in VAB planner rounded up
		@maxAmount = 20250
	}
	RESOURCE
	{
		name = FiltrationMaterial // Filter for 45d
		amount = 33.75
		maxAmount = 33.75
	}
}

@PART[KKAOSS_LS_container_kerbalism_big]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@mass = 0.24
	@RESOURCE[Food]
	{
		@amount = 84 // Double it here
		@maxAmount = 84
	}
	@RESOURCE[Oxygen]
	{
		@amount = 40500  // Default profile for 3 crew is 99d 5h in VAB planner rounded up
		@maxAmount = 40500
	}
	RESOURCE
	{
		name = FiltrationMaterial // Filter for 90d
		amount = 67.5
		maxAmount = 67.5
	}
}


// ============================================================================
// Patch the various PBS Oxygen Containers
// ============================================================================
@PART[KKAOSS_LS_container_oxygen_small]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@RESOURCE[Oxygen]
	{
		@amount = 40500 // Default profile for 3 crew is 99d 5h without scrubber
		@maxAmount = 40500
	}
}

@PART[KKAOSS_LS_container_oxygen_big]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@RESOURCE[Oxygen]
	{
		@amount = 81000 // // Double it here
		@maxAmount = 81000
	}
}


// ============================================================================
// Patch the various PBS CO2 Containers
// ============================================================================
@PART[KKAOSS_LS_container_co2_small]:NEEDS[RealismProfile&PlanetarySurfaceStructures]:AFTER[PlanetarySurfaceStructures]
{

	@RESOURCE[CarbonDioxide]
	{
		%isTweakable = false
		%isVisible = true

		@amount = 0
		@maxAmount = 105 //45 days for 3 crew ??
	}
}


// ============================================================================
// Miscellaneous Patching
// ============================================================================

// Recreate the small water tank. KPBS only uses this tank with TACLS. Force it into Kerbalism.
PART:NEEDS[RealismProfile&PlanetarySurfaceStructures]
{
	// Kerbal Space Program - Part Config
	// A small container to store water

	MODEL
	{
	model = PlanetaryBaseInc/ModSupport/Parts/LifeSupport/Container_Water_small
	}

	// --- general parameters ---
	name = KKAOSS_LS_container_water_small
	module = Part
	author = Nils277

	// --- asset parameters ---
	scale = 1
	rescaleFactor = 1
	CoMOffset = -0.45, 0, 0

	// --- node definitions ---
	node_stack_top = 0, 0, 0, 1, 0, 0, 1

	// --- editor parameters ---
	TechRequired = spaceExploration
	entryCost = 9000
	cost = 1201
	category = Utility
	subcategory = 0
	title = K&K Water Small Container
	manufacturer = K&K Life-Support Devision
	description = A small container for water. It can be used to shower, drink, wash or for a water slide.

	// --- attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision ---
	attachRules = 1,0,1,1,0

	// --- standard part parameters ---
	mass = 0.2
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	crashTolerance = 15
	maxTemp = 2000 // = 3000


	RESOURCE
	{
		name = Water
		amount = 135 // 45 days for 3 crew
		maxAmount = 135
	}
}